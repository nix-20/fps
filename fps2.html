<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FPS 2.0 - Più figo</title>
<style>
  html, body {
    margin:0; padding:0; overflow:hidden;
    background: linear-gradient(135deg, #0a0a0a, #1c1c1c);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    user-select:none;
  }
  #gameCanvas {
    display:block;
    background: #111;
    width: 100vw;
    height: 100vh;
    cursor: crosshair;
  }
  #hud {
    position: absolute;
    top: 10px; left: 10px;
    font-size: 20px;
    text-shadow: 0 0 5px #0f0;
  }
  #healthBar {
    position: absolute;
    top: 40px; left: 10px;
    width: 200px; height: 25px;
    border: 2px solid #0f0;
    border-radius: 8px;
    background: #222;
  }
  #healthFill {
    height: 100%;
    background: #0f0;
    border-radius: 6px;
    width: 100%;
    transition: width 0.3s ease;
  }
  #startScreen {
    position: absolute; top:0; left:0; right:0; bottom:0;
    background: #000d;
    display: flex; justify-content: center; align-items: center; flex-direction: column;
    z-index: 10;
  }
  #startBtn {
    font-size: 28px;
    padding: 15px 40px;
    cursor: pointer;
    background: #00aa00;
    border: none;
    border-radius: 12px;
    color: white;
    box-shadow: 0 0 12px #0f0;
    transition: background 0.3s;
  }
  #startBtn:hover {
    background: #009000;
  }
</style>
</head>
<body>

<div id="startScreen">
  <h1>FPS 2.0 - Più figo</h1>
  <button id="startBtn">Avvia partita</button>
  <p style="margin-top:15px; font-size: 16px; color: #ccc;">WASD per muoverti, mouse per mirare e clic per sparare</p>
</div>

<canvas id="gameCanvas"></canvas>
<div id="hud">
  Nemici eliminati: <span id="score">0</span>
</div>
<div id="healthBar">
  <div id="healthFill"></div>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const startScreen = document.getElementById('startScreen');
  const startBtn = document.getElementById('startBtn');
  const scoreEl = document.getElementById('score');
  const healthFill = document.getElementById('healthFill');

  let width, height;
  let keys = {};
  let player = {
    x: 0,
    y: 0,
    size: 20,
    speed: 5,
    health: 100,
    maxHealth: 100,
    cooldown: 0
  };
  let bullets = [];
  let enemies = [];
  let score = 0;
  let gameRunning = false;

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    if (!gameRunning) {
      player.x = width / 2;
      player.y = height / 2;
    }
  }

  function spawnEnemy() {
    const size = 25 + Math.random() * 10;
    let x, y;
    // Spawn nemici ai bordi, lontano dal giocatore
    do {
      x = Math.random() * width;
      y = Math.random() * height;
    } while (Math.abs(x - player.x) < 200 && Math.abs(y - player.y) < 200);

    enemies.push({
      x, y,
      size,
      speed: 1 + Math.random() * 1.5,
      alive: true,
      vx: 0,
      vy: 0,
      damageCooldown: 0,
    });
  }

  function drawPlayer() {
    ctx.fillStyle = 'deepskyblue';
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
    ctx.fill();
  }

  function drawEnemies() {
    enemies.forEach(e => {
      if (!e.alive) return;
      ctx.fillStyle = 'crimson';
      ctx.beginPath();
      ctx.arc(e.x, e.y, e.size, 0, Math.PI*2);
      ctx.fill();
    });
  }

  function drawBullets() {
    ctx.fillStyle = 'yellow';
    bullets.forEach(b => {
      ctx.beginPath();
      ctx.arc(b.x, b.y, 6, 0, Math.PI*2);
      ctx.fill();
    });
  }

  function updatePlayer() {
    if (keys['w'] || keys['ArrowUp']) player.y -= player.speed;
    if (keys['s'] || keys['ArrowDown']) player.y += player.speed;
    if (keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
    if (keys['d'] || keys['ArrowRight']) player.x += player.speed;

    // Limiti schermo
    player.x = Math.min(Math.max(player.x, player.size), width - player.size);
    player.y = Math.min(Math.max(player.y, player.size), height - player.size);

    // Cooldown sparo
    if (player.cooldown > 0) player.cooldown -= 1;
  }

  function updateEnemies() {
    enemies.forEach(e => {
      if (!e.alive) return;
      // Movimento verso il giocatore (IA semplice)
      const dx = player.x - e.x;
      const dy = player.y - e.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist > 1) {
        e.vx = (dx / dist) * e.speed;
        e.vy = (dy / dist) * e.speed;
      } else {
        e.vx = 0;
        e.vy = 0;
      }
      e.x += e.vx;
      e.y += e.vy;

      // Danno se tocca il giocatore
      if (dist < e.size + player.size) {
        if (e.damageCooldown <= 0) {
          player.health -= 10;
          e.damageCooldown = 50;
          if (player.health < 0) player.health = 0;
        }
      }

      if (e.damageCooldown > 0) e.damageCooldown--;
    });
  }

  function updateBullets() {
    bullets.forEach((b, i) => {
      b.x += b.vx;
      b.y += b.vy;

      // Rimuovi se fuori schermo
      if (b.x < 0 || b.x > width || b.y < 0 || b.y > height) {
        bullets.splice(i, 1);
        return;
      }

      // Collisione con nemici
      enemies.forEach((e, ei) => {
        if (!e.alive) return;
        const dx = b.x - e.x;
        const dy = b.y - e.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < e.size + 6) {
          e.alive = false;
          bullets.splice(i, 1);
          score++;
          scoreElUpdate();
          // Respawn nemico dopo 3 secondi
          setTimeout(() => {
            enemies.splice(ei, 1);
            spawnEnemy();
          }, 3000);
        }
      });
    });
  }

  function scoreElUpdate() {
    scoreEl.textContent = score;
  }

  function drawCrosshair() {
    const size = 15;
    ctx.strokeStyle = 'white';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(width/2 - size/2, height/2);
    ctx.lineTo(width/2 + size/2, height/2);
    ctx.moveTo(width/2, height/2 - size/2);
    ctx.lineTo(width/2, height/2 + size/2);
    ctx.stroke();
  }

  function draw() {
    ctx.clearRect(0,0,width,height);

    drawPlayer();
    drawEnemies();
    drawBullets();
    drawCrosshair();

    // Aggiorna barra salute
    const hpPercent = player.health / player.maxHealth;
    healthFill.style.width = (hpPercent * 100) + '%';

    if (player.health <= 0) {
      gameOver();
    }
  }

  function gameOver() {
    gameRunning = false;
    alert('Sei morto! Nemici eliminati: ' + score);
    location.reload();
  }

  function gameLoop() {
    if (!gameRunning) return;
    updatePlayer();
    updateEnemies();
    updateBullets();
    draw();
    requestAnimationFrame(gameLoop);
  }

  // Input
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  canvas.addEventListener('click', e => {
    if (!gameRunning) return;
    if (player.cooldown > 0) return;

    // Spara verso il mouse
    const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    const speed = 15;
    bullets.push({
      x: player.x + Math.cos(angle) * player.size,
      y: player.y + Math.sin(angle) * player.size,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
    });
    player.cooldown = 15; // cooldown sparo
  });

  startBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    canvas.style.display = 'block';
    gameRunning = true;
    resize();
    // Spawn 5 nemici iniziali
    enemies = [];
    for(let i=0; i<5; i++) spawnEnemy();
    score = 0;
    scoreEl.textContent = '0';
    player.health = player.maxHealth;
    gameLoop();
  });

  window.addEventListener('resize', () => {
    resize();
  });

  // Primo resize
  resize();
})();
</script>

</body>
</html>
